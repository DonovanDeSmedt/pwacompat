'use strict';
var _typeof =
  'function' == typeof Symbol && 'symbol' == typeof Symbol.iterator
    ? function(d) {
        return typeof d;
      }
    : function(d) {
        return d && 'function' == typeof Symbol && d.constructor === Symbol && d !== Symbol.prototype
          ? 'symbol'
          : typeof d;
      };
(function() {
  function d() {
    E && document.querySelector('link[rel="manifest"]').setAttribute('rel', 'no-on-ios');
    var H = document.head.querySelector('link[rel="manifest"]'),
      I = H ? H.href : '',
      J = g([I, window.location]);
    Promise.resolve()
      .then(function() {
        if (!I) throw 'can\'t find <link rel="manifest" href=".." />\'';
        var K = {};
        return 'use-credentials' === I.crossOrigin && (K.credentials = 'include'), window.fetch(I, K);
      })
      .then(function(K) {
        return K.json();
      })
      .then(function(K) {
        return l(K, J);
      })
      .catch(function(K) {
        return console.warn('pwacompat.js error', K);
      });
  }
  function g(H) {
    for (
      var _ret,
        _loop = function(I) {
          var I = H[I];
          try {
            return (
              new URL('', I),
              {
                v: function v(K) {
                  return new URL(K, I).toString();
                }
              }
            );
          } catch (K) {}
        };
      i < H.length;
      ++i
    )
      if (((_ret = _loop(0)), 'object' === ('undefined' == typeof _ret ? 'undefined' : _typeof(_ret)))) return _ret.v;
    return function(I) {
      return I;
    };
  }
  function h(H, I) {
    var J = document.createElement(H);
    for (var K in I) J.setAttribute(K, I[K]);
    return document.head.appendChild(J), J;
  }
  function j(H, I) {
    I && (!0 === I && (I = 'yes'), h('meta', { name: H, content: I }));
  }
  function l(H, I) {
    function J(_ref, Y, Z) {
      var W = _ref.width,
        X = _ref.height,
        $ = window.devicePixelRatio,
        _ = w({ width: W * $, height: X * $ });
      _.scale($, $),
        (_.fillStyle = H.background_color || y),
        _.fillRect(0, 0, W, X),
        _.translate(W / 2, (X - C) / 2),
        (_.font = z + 'px HelveticaNeue-CondensedBold'),
        (_.fillStyle = Q ? 'white' : 'black');
      var aa = _.measureText(R).width;
      if (Z) {
        var ba = Z.width / $,
          ca = Z.height / $;
        ca > A && ((ba /= ca / A), (ca = A)),
          ba >= B && ca >= B && (_.drawImage(Z, ba / -2, ca / -2, ba, ca), _.translate(0, ca / 2 + C));
      }
      _.fillText(R, aa / -2, 0);
      var da = document.createElement('link');
      return (
        da.setAttribute('rel', 'apple-touch-startup-image'),
        da.setAttribute('media', '(orientation: ' + Y + ')'),
        da.setAttribute('href', _.canvas.toDataURL()),
        da
      );
    }
    function K(W) {
      var X = J(window.screen, 'portrait', W),
        Y = J({ width: window.screen.height, height: window.screen.width }, 'landscape', W);
      T.forEach(function(Z) {
        return Z.remove();
      }),
        document.head.appendChild(X),
        document.head.appendChild(Y),
        T.add(X),
        T.add(Y);
    }
    var L = H.icons || [];
    L.sort(function(W, X) {
      return parseInt(X.sizes, 10) - parseInt(W.sizes, 10);
    });
    var M = L.map(function(W) {
        var X = { rel: 'icon', href: I(W.src), sizes: W.sizes };
        if ((h('link', X), D)) return (X.rel = 'apple-touch-icon'), h('link', X);
      }),
      N = H.display,
      O = -1 !== x.indexOf(N);
    j('mobile-web-app-capable', O),
      o(H.theme_color || 'black'),
      F && (j('msapplication-starturl', H.start_url || '/'), j('msapplication-TileColor', H.theme_color)),
      document.head.querySelector('[name="theme-color"]') || j('theme-color', H.theme_color);
    var P = n(H.orientation);
    if (
      (j('x5-orientation', P),
      j('screen-orientation', P),
      'fullscreen' === N
        ? (j('x5-fullscreen', 'true'), j('full-screen', 'yes'))
        : O && (j('x5-page-mode', 'app'), j('browsermode', 'application')),
      !!D)
    ) {
      var Q = s(H.background_color || y),
        R = H.name || H.short_name || document.title,
        S = m(H.related_applications);
      S && j('apple-itunes-app', 'app-id=' + S),
        j('apple-mobile-web-app-capable', O),
        j('apple-mobile-web-app-title', R);
      new Set();
      if ((K(null), !!M.length)) {
        var U = M[0],
          V = new Image();
        (V.crossOrigin = 'anonymous'),
          (V.onload = function() {
            if ((K(V), !!H.background_color)) {
              var W = u(V, H.background_color);
              null === W ||
                ((U.href = W),
                M.slice(1).forEach(function(X) {
                  var Y = new Image();
                  (Y.crossOrigin = 'anonymous'),
                    (Y.onload = function() {
                      var Z = u(Y, H.background_color, !0);
                      X.href = Z;
                    }),
                    (Y.src = X.href);
                }));
            }
          }),
          (V.src = U.href);
      }
    }
  }
  function m(H) {
    var I;
    return (
      (H || [])
        .filter(function(J) {
          return 'itunes' === J.platform;
        })
        .forEach(function(J) {
          if (J.id) I = J.id;
          else {
            var K = J.url.match(/id(\d+)/);
            K && (I = K[1]);
          }
        }),
      I
    );
  }
  function n(H) {
    H = (H || '') + '';
    var I = H.substr(0, 3);
    if ('por' === I) return 'portrait';
    return 'lan' === I ? 'landscape' : '';
  }
  function o(H) {
    if (D || G) {
      var I = s(H);
      if (D) j('apple-mobile-web-app-status-bar-style', I ? 'black' : 'default');
      else {
        var J = p();
        if (null === J) return void console.debug('UWP no titleBar');
        (J.foregroundColor = q(I ? 'black' : 'white')), (J.backgroundColor = q(H));
      }
    }
  }
  function p() {
    try {
      return Windows.UI.ViewManagement.ApplicationView.getForCurrentView().titleBar;
    } catch (H) {
      return null;
    }
  }
  function q(H) {
    var I = r(H);
    return { r: I[0], g: I[1], b: I[2], a: I[3] };
  }
  function r(H) {
    var I = w();
    return (I.fillStyle = H), I.fillRect(0, 0, 1, 1), I.getImageData(0, 0, 1, 1).data;
  }
  function s(H) {
    var I = r(H),
      J = I.map(function(M) {
        var N = M / 255;
        return 0.03928 > N ? N / 12.92 : Math.pow((N + 0.055) / 1.055, 2.4);
      }),
      K = 0.2126 * J[0] + 0.7152 * J[1] + 0.0722 * J[2],
      L = Math.abs(1.05 / (K + 0.05));
    return 3 < L;
  }
  function u(H, I) {
    var J = 2 < arguments.length && void 0 !== arguments[2] && arguments[2],
      K = w(H);
    if ((K.drawImage(H, 0, 0), !J)) {
      var L = K.getImageData(0, 0, 1, 1);
      if (255 == L.data[3]) return null;
    }
    return (
      (K.globalCompositeOperation = 'destination-over'),
      (K.fillStyle = I),
      K.fillRect(0, 0, H.width, H.height),
      K.canvas.toDataURL()
    );
  }
  function w() {
    var _ref2 = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : { width: 1, height: 1 },
      H = _ref2.width,
      I = _ref2.height,
      J = document.createElement('canvas');
    return (J.width = H), (J.height = I), J.getContext('2d');
  }
  if ('fetch' in window) {
    var D = navigator.vendor && -1 !== navigator.vendor.indexOf('Apple'),
      E = !!navigator.platform && /iPhone/.test(navigator.platform),
      F = navigator.userAgent && -1 !== navigator.userAgent.indexOf('Edge'),
      G = 'undefined' != typeof Windows;
    'complete' === document.readyState ? d() : window.addEventListener('load', d);
  }
})();
